<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html 	xmlns="http://www.w3.org/1999/xhtml"
		xmlns:h="http://java.sun.com/jsf/html"  
   		xmlns:f="http://java.sun.com/jsf/core" 
    	xmlns:p="http://primefaces.org/ui"
    	xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>


</h:head>
   	
<h:body>
<ui:composition template="templates/geral.xhtml">
<ui:define name="titulo">RECORD NEWS - ENGENHARIA</ui:define>
<ui:define name="conteudo">

<f:facet name="header">Controle de Sinais</f:facet>

<h:form id="formCad">
	<p:panel id="panel" rendered="#{acessoBean.temAcessoControleSinal}">
		<p:panelGrid columns="3" >
			<h:outputLabel value="Posto"/>
			<h:outputLabel value="Técnico"/>
			<h:outputLabel value="Problema"/>
	        <p:autoComplete id="posto" value="#{controlesinalMB.posto}" completeMethod="#{controlesinalMB.completePosto}" size="30"
	        		disabled="#{controlesinalMB.controlaCadastro eq 0}" placeholder="Digite o posto"
                    var="p" itemLabel="#{p.nome}" itemValue="#{p}" converter="postoConverter" forceSelection="true" 
                    required="true" requiredMessage="Informe o posto"/>			
			<p:inputText id="tec" value="#{controlesinalMB.controlesinal.tecnico}" placeholder="Nome do Técnico ou Empresa" maxlength="150" size="30" disabled="#{controlesinalMB.controlaCadastro eq 0}"
				required="true" requiredMessage="Informe o nome do técnico ou empresa"/>
			<p:inputText id="prob" value="#{controlesinalMB.controlesinal.problema}" placeholder="Defeito Reclamado" maxlength="254" size="60" disabled="#{controlesinalMB.controlaCadastro eq 0}"
				required="true" requiredMessage="Informe o problema ou defeito reclamado"/>
		</p:panelGrid>
		<p:panelGrid columns="4" >
			<h:outputLabel value="Tipo Equipamento"/>
			<h:outputLabel value="Tipo Manutenção"/>
			<h:outputLabel value="Data do Problema"/>
			<h:outputLabel value="Nº Patrimônio"/>

	        <p:selectOneMenu id="teqp" value="#{controlesinalMB.controlesinal.tipoequipamento}" style="width:130px;"
	        	disabled="#{controlesinalMB.controlaCadastro eq 0}" styleClass="oneMenu">
	            <f:selectItem itemLabel="Selecione o Equipamento" itemValue="" />
	            <f:selectItem itemLabel="TX" itemValue="TX" />
	            <f:selectItem itemLabel="Ar Condicionado" itemValue="Ar Condicionado" />
	        </p:selectOneMenu>
	        <p:selectOneMenu id="tmanut" value="#{controlesinalMB.controlesinal.tipomanutencao}"  style="width:130px;"
	        	disabled="#{controlesinalMB.controlaCadastro eq 0}" styleClass="oneMenu">
	            <f:selectItem itemLabel="Manutenção Corretiva ou Preventiva" itemValue="" />
	            <f:selectItem itemLabel="Corretiva" itemValue="Corretiva" />
	            <f:selectItem itemLabel="Preventiva" itemValue="Preventiva" />
	        </p:selectOneMenu>
			<p:calendar id="dtpro" value="#{controlesinalMB.controlesinal.dataproblema}" locale="pt_BR" pattern="dd/MM/yyyy" size="11" 
				disabled="#{controlesinalMB.controlaCadastro==0}" required="true" requiredMessage="Informe data do problema"/>								
			<p:inputText value="#{controlesinalMB.controlesinal.patrimonio}" maxlength="10" size="10" disabled="#{controlesinalMB.controlaCadastro==0}" />				
 		
 		</p:panelGrid>
 		
 		<p:panelGrid columns="3" >
			<h:outputLabel value="Data da Solução"/>
			<h:outputLabel value="Solução"/>
			<h:outputLabel value="Pendências"/>

			<p:calendar id="dtsol" value="#{controlesinalMB.controlesinal.datasolucao}" locale="pt_BR" pattern="dd/MM/yyyy" size="11" 
				disabled="#{controlesinalMB.controlaCadastro==0}"/>								
			<p:inputTextarea id="solu" value="#{controlesinalMB.controlesinal.solucao}" placeholder="Solução" maxlength="1500" 
				disabled="#{controlesinalMB.controlaCadastro eq 0}" style="width:250px;"/>
			<p:inputTextarea id="pende" value="#{controlesinalMB.controlesinal.pendencia}" placeholder="Pendências" maxlength="1500" 
				disabled="#{controlesinalMB.controlaCadastro eq 0}" style="width:250px;"/>
 		</p:panelGrid>		
 
 		<p:panelGrid columns="4" >
			<h:outputLabel value="Valor do Atendimento"/>
			<h:outputLabel value="Compra de Peça"/>
			<h:outputLabel value="Valor da Peça"/>
			<h:outputLabel value="Próxima Preventiva"/>
			
			<p:inputText id="vla" value="#{controlesinalMB.controlesinal.valoratendimento}" size="20" disabled="#{controlesinalMB.controlaCadastro eq 0}" >
			 	<f:convertNumber type="number" minFractionDigits="2" maxFractionDigits="2"/>	           															 	
			</p:inputText>	
	        <p:selectOneMenu id="cmpe" value="#{controlesinalMB.controlesinal.comprapeca}"  style="width:80px;"
	        	disabled="#{controlesinalMB.controlaCadastro eq 0}" styleClass="oneMenu">
	            <f:selectItem itemLabel="Compra de Peça?" itemValue="" />
	            <f:selectItem itemLabel="Sim" itemValue="Sim" />
	            <f:selectItem itemLabel="Não" itemValue="Não" />
	        </p:selectOneMenu>
			<p:inputText id="vlp" value="#{controlesinalMB.controlesinal.valorpeca}" size="20" disabled="#{controlesinalMB.controlaCadastro eq 0}" >
			 	<f:convertNumber type="number" minFractionDigits="2" maxFractionDigits="2"/>	           															 	
			</p:inputText>									
			<p:calendar id="dtpre" value="#{controlesinalMB.controlesinal.proximapreventiva}" locale="pt_BR" pattern="dd/MM/yyyy" size="11" 
				disabled="#{controlesinalMB.controlaCadastro==0}" />								

 		</p:panelGrid>
 		
		<br></br>
		<hr></hr>
		<p:panelGrid columns="2">
			<h:outputLabel value="Selecione o arquivo do Relatório em pdf a ser importado."/>
			<h:outputLabel value="Seleção da Foto"/>
		    <p:fileUpload fileUploadListener="#{controlesinalMB.handleFileUpload}" mode="advanced"  disabled="#{controlesinalMB.controlaCadastro != 2}" 
		    	dragDropSupport="false" sizeLimit="1000000" fileLimit="1" allowTypes="/(\.|\/)(pdf)$/"
		    	label="Selecionar" uploadLabel="Importar" cancelLabel="Cancelar"/>
			<p:fileUpload fileUploadListener="#{controlesinalMB.fotoPosto}" 
			       mode="advanced" dragDropSupport="false" disabled="#{controlesinalMB.controlaCadastro != 2}"
			       multiple="true" update=":formMsg" sizeLimit="7000000" 
			       fileLimit="15" allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
			       fileLimitMessage="Permitido apenas 15 arquivo por vez."
			       invalidFileMessage="Tipo de Arquivo inválido. Somente gif, jpg ou png."
			       invalidSizeMessage="Tamanho do arquivo não permitido. Limite 7 Mb."
			       cancelLabel="Cancelar" uploadLabel="Enviar" label="Localizar"
			  />		
		</p:panelGrid>
		<br></br>
		<p:commandButton value="#{controlesinalMB.controlesinal.arquivo}" oncomplete="PF('arq').show()" rendered="#{controlesinalMB.controlesinal.arquivo != null}"/>
		<p:commandButton value="Vizualizar Fotos" action="#{controlesinalMB.openImages}" ajax="false" onclick="form.target='_blank'" rendered="#{controlesinalMB.images.size() > 0}"/>
		<hr></hr>
					
		<f:facet name="footer">
			<p:panelGrid columns="6" style="border: none !important; ">
				<p:commandButton value="Novo" action="#{controlesinalMB.novo}" update=":formCad" />
				<p:commandButton value="Remover" action="#{controlesinalMB.exclui}" disabled="#{controlesinalMB.controlesinal.id==null}" update=":formCad,:formMsg" />
            	<p:commandButton value="Selecionar"  update=":formSelecao" oncomplete="PF('dgSelecao').show()" />
				<p:commandButton value="Limpar" action="#{controlesinalMB.limpaCadastro}" update=":formCad" />
				<p:commandButton value="Gravar" action="#{controlesinalMB.grava}" update=":formCad,:formMsg" />
			</p:panelGrid>		
		</f:facet>
	</p:panel>	
</h:form>

<p:dialog id="dgSelecao" widgetVar="dgSelecao" appendTo="@(body)" modal="true" header="Controle de Sinais" width="40%;" resizable="false">
	<h:form id="formSelecao" style="width:600px;">

	    <p:dataTable id="ctr" var="c" value="#{controlesinalMB.controlesinais}" selectionMode="single" 
	    	selection="#{controlesinalMB.controlesinalSel}" rowKey="#{c.id}" emptyMessage="" rows="5" paginator="true" paginatorPosition="bottom">
	    	<f:facet name="header">Cadastrados</f:facet>
			<p:ajax event="rowSelect" listener="#{controlesinalMB.selecao}" update=":formCad"  oncomplete="PF('dgSelecao').hide()"/>

	        <p:column headerText="Data" width="15%;" filterBy="#{c.dataproblema}">
              <h:outputText value="#{c.dataproblema}">
				<f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR"/>
			  </h:outputText>
			</p:column>       
	        <p:column headerText="Posto" width="20%;" filterBy="#{c.posto.nome}">
	            <h:outputText value="#{c.posto.nome}" />
	        </p:column>			       
	        <p:column headerText="Problema" width="200px;">
	            <h:outputText value="#{c.problema}" />
	        </p:column>			       
	               
	    </p:dataTable>


	</h:form>
</p:dialog>

<p:dialog header="#{controlesinalMB.controlesinal.arquivo}" widgetVar="arq" showEffect="fade" hideEffect="fade" width="900" height="600" rendered="#{controlesinalMB.controlesinal.arquivo != null}">
	<h:form id="formD">
		<object type="application/pdf" data="#{request.contextPath}/temp/#{controlesinalMB.controlesinal.posto.nome}/#{controlesinalMB.controlesinal.id}/#{controlesinalMB.controlesinal.arquivo}?pfdrid_c=true" height="500px" width="100%">
            Seu navegador não pode exibir o pdf ou o arquivo não existe.
        </object>
	</h:form>
</p:dialog>

<h:form id="formMsg">                      
    <p:growl id="msg" showDetail="true" life="4000"/> 
</h:form>
</ui:define>
</ui:composition>	
</h:body>	

</html>