<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html 	xmlns="http://www.w3.org/1999/xhtml"
		xmlns:h="http://java.sun.com/jsf/html"  
   		xmlns:f="http://java.sun.com/jsf/core" 
    	xmlns:p="http://primefaces.org/ui"
    	xmlns:pe="http://primefaces.org/ui/extensions"
    	xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>


</h:head>
   	
<h:body>
<ui:composition template="templates/geral.xhtml">
<ui:define name="titulo">RECORD NEWS - COMPRAS</ui:define>
<ui:define name="conteudo">

<f:facet name="header">Controle de Contratos</f:facet>

<h:form id="form">
	<p:panel>
		<p:panel style="background:#F0F8FF !important;">
			<h:panelGrid columns="1" >
		        <p:selectOneRadio id="clifor" value="#{visaogerencialcontratoMB.especie}">
		            <f:selectItem itemLabel="Fornecedores (Compra)" itemValue="1" />
		            <f:selectItem itemLabel="Clientes (Venda)" itemValue="2" />
		            <p:ajax listener="#{visaogerencialcontratoMB.filtraTipoDeContratoPorEspecie}" update=":form"/>
		        </p:selectOneRadio>	
		    </h:panelGrid>
			<h:panelGrid columns="2">
		
		    	<p:orderList value="#{visaogerencialcontratoMB.tipos}" var="t" controlsLocation="none" 
		    	   		itemLabel="#{t.descricao}" itemValue="#{t}" converter="tipoContratoConverter">
		    	   		<p:ajax event="select" listener="#{visaogerencialcontratoMB.filtraPorEspecieTipo}" update=":form"/>
		    	</p:orderList>	
		
		     	<p:orderList value="#{visaogerencialcontratoMB.fornecedores}" var="f" controlsLocation="none" rendered="#{visaogerencialcontratoMB.especie eq 1}"
		     	   		itemLabel="#{f.nome}" itemValue="#{f}" converter="fornecedorConverter">
		     	   		<p:ajax event="select" listener="#{visaogerencialcontratoMB.filtraPorEspecieTipoCliFor}" update=":form"/>
		     	</p:orderList>
		     	<p:orderList value="#{visaogerencialcontratoMB.clientes}" var="c" controlsLocation="none" rendered="#{visaogerencialcontratoMB.especie eq 2}"
		     	   		itemLabel="#{c.nome}" itemValue="#{c}" converter="clienteConverter">
		     	   		<p:ajax event="select" listener="#{visaogerencialcontratoMB.filtraPorEspecieTipoCliFor}" update=":form"/>
		     	</p:orderList>       	   				
		
			</h:panelGrid>
		</p:panel>
	    <p:dataTable id="ctr" var="c" value="#{visaogerencialcontratoMB.contratosSelecionados}" selectionMode="single" 
	    	selection="#{visaogerencialcontratoMB.contratoSelecionado}" rowKey="#{c.id}" emptyMessage="Nenhum registro encrontrado." rows="5" paginator="true" paginatorPosition="bottom">
	    	
	    	<f:facet name="header">Contratos cadastrados #{c.cliente.nome} #{c.fornecedor.nome}</f:facet>
	    	
 	        <p:ajax event="rowSelect" listener="#{visaogerencialcontratoMB.selecao}" update=":formT" oncomplete="PF('arqSel').show()"/>

	        <p:column headerText="Tipo de Contrato" style="width:12%;">
              <h:outputText value="#{c.tipo.descricao}"/>
            </p:column>	
 	       
	        <p:column headerText=" Data Início" style="width:12%;">
              <h:outputText value="#{c.inicio}">
				 <f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR"/>
			  </h:outputText>
            </p:column>	 
	        <p:column headerText="Data Fim" style="width:12%;">
              <h:outputText value="#{c.fim}">
				 <f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR"/>
			  </h:outputText>
            </p:column>	                        
	        <p:column headerText="Valor" style="width:9%;text-align: right;">
				<h:outputText value="#{c.valor}" style="ttext-align: right;">
					<f:convertNumber type="number" minFractionDigits="2" maxFractionDigits="2"/>	           																
				</h:outputText>	
		    </p:column>	          
	        <p:column headerText="Objeto" width="40%">
	            <h:outputText value="#{c.objeto}" />
	        </p:column>	
	    </p:dataTable>
	</p:panel>
</h:form>


<p:dialog header="Visualizar documentos" widgetVar="arqSel" showEffect="fade" hideEffect="fade" width="500" height="200"  appendTo="@(body)" modal="true">
	<h:form id="formT">
	    <p:dataTable id="tbd" var="d" value="#{visaogerencialcontratoMB.contratoSelecionado.documentos}" emptyMessage="Nenhum documento encrontrado.">
	        <f:facet name="header">
	            Anexos
	        </f:facet>

	        <p:column headerText="Descrição">
	            <h:outputText value="#{d.descricao}" />
	        </p:column>
	        <p:column style="width:32px;text-align: center">
	             <p:commandButton update=":formD" oncomplete="PF('arq').show()" icon="ui-icon-search" title="Visualizar">
	                <f:setPropertyActionListener value="#{d}" target="#{visaogerencialcontratoMB.documento}" />
	            </p:commandButton>
	        </p:column>
	    </p:dataTable>	    
	</h:form>
</p:dialog>

<p:dialog header="Documento" widgetVar="arq" showEffect="fade" hideEffect="fade" width="900" height="600"  appendTo="@(body)" modal="true">	
	<h:form id="formD">
		<object type="application/pdf" data="#{request.contextPath}/temp/compras/#{visaogerencialcontratoMB.documento.contrato.id}/#{visaogerencialcontratoMB.documento.arquivo}?pfdrid_c=true" height="500px" width="100%">
	        Seu navegador não pode exibir o pdf ou o arquivo não existe.
	    </object>	
	</h:form>
</p:dialog>
<h:form id="formMsg">                      
    <p:growl id="msg" showDetail="true" life="4000"/> 
</h:form>
</ui:define>
</ui:composition>	
</h:body>	

</html>