<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html 	xmlns="http://www.w3.org/1999/xhtml"
		xmlns:h="http://java.sun.com/jsf/html"  
   		xmlns:f="http://java.sun.com/jsf/core"  
    	xmlns:p="http://primefaces.org/ui"
    	xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>


</h:head>
   	
<h:body>
<ui:composition template="templates/geral.xhtml">
<ui:define name="titulo">RECORD NEWS</ui:define>
<ui:define name="conteudo">
<f:facet name="header">Baixa de Bem</f:facet>

<h:form id="formCad">

	<p:panel>
	    <p:wizard flowListener="#{baixabemMB.onFlowProcess}" backLabel="Anterior" nextLabel="Próximo" >
	   
	        <p:tab id="gerais" title="Dados Gerais" >
	            <p:panel header="Dados Gerais" >
	            	<p:messages autoUpdate="true"/>
					<p:panelGrid columns="2">	
						<h:outputLabel value="Registro nro.:" />
						<h:outputLabel value="#{baixabemMB.baixabem.id}" />		
						<h:outputLabel value="Filial"/>
						<p:selectOneMenu id="fil" value="#{baixabemMB.baixabem.filial}" converter="filialConverter" style="width:130px;" disabled="#{baixabemMB.controlaCadastro == 0}">
							<f:selectItems value="#{baixabemMB.filiais}" var="f" itemLabel="#{f.nome}" itemValue="#{f}" />
							<p:ajax event="change" listener="#{baixabemMB.carregaCentroCustosDaFilial}" update="cst"/>
						</p:selectOneMenu>									
						<h:outputLabel value="Centro de Custo"/>
						<p:selectOneMenu id="cst" value="#{baixabemMB.baixabem.ccusto}" converter="ccustoConverter" style="width:130px;" disabled="#{baixabemMB.controlaCadastro == 0}">
							<f:selectItems value="#{baixabemMB.custosFilial}" var="c" itemLabel="#{c.nome}" itemValue="#{c}" />
						</p:selectOneMenu>						
						<h:outputLabel value="Tipo de Baixa"/>
						<p:selectOneMenu id="cat" value="#{baixabemMB.tipoBaixa}"  style="width:100px;" disabled="#{baixabemMB.controlaCadastro == 0}" >
							<f:selectItem itemLabel="#{baixabemMB.tipoBaixa}" itemValue="#{baixabemMB.tipoBaixa}" />
							<f:selectItems value="#{baixabemMB.tiposBaixa}"/>
						</p:selectOneMenu>
						<h:outputLabel value="Data da Baixa"/>
						<p:calendar value="#{baixabemMB.data}"  locale="pt_BR" pattern="dd/MM/yyyy" size="12" disabled="#{baixabemMB.controlaCadastro == 0}" />
					</p:panelGrid>
			   	</p:panel>     	
			</p:tab>

			<p:tab id="patrimonios" title="Patrimônios">	
				<p:panel header="Patrimônios" id="ptrs">
					<p:messages autoUpdate="true"/>	
					<p:panelGrid columns="3" >
						<h:outputLabel value="Nº Patrimônio"/>
						<p:inputText value="#{baixabemMB.codigo}" maxlength="6" size="12" disabled="#{baixabemMB.controlaCadastro == 0}" />				
						<p:commandButton value="Adicionar" action="#{baixabemMB.encontrarBem}" update=":formMsg,:formCad,:formCad:ptrs"  onstart="PF('status').show()" onsuccess="PF('status').hide()" disabled="#{baixabemMB.controlaCadastro == 0}"/>
					</p:panelGrid>
					<p:panelGrid columns="2" id="dados" rendered="false">
						<h:outputLabel value="Data da Aquisição"/>
						<p:calendar id="dtaqui" value="#{baixabemMB.baixabem.dataaquisicao}"  locale="pt_BR" pattern="dd/MM/yyyy" size="12" disabled="#{baixabemMB.patrimonios.size()!=0 || baixabemMB.controlaCadastro == 0}"/>
						<h:outputLabel value="Descrição"/>
						<p:inputText value="#{baixabemMB.baixabem.descricaoBem}" size="55" disabled="#{baixabemMB.patrimonios.size()!=0 || baixabemMB.controlaCadastro == 0}" />		
						<h:outputLabel value="Valor Total de Compra"/>
						<p:inputText value="#{baixabemMB.totalCompra}" size="12" disabled="true" >
						 	<f:convertNumber type="number" minFractionDigits="2" maxFractionDigits="2"/>	           															 	
						</p:inputText>								
						<h:outputLabel value="Valor Residual"/>
						<p:inputText value="#{baixabemMB.totalResidual}" size="12" disabled="true" >
						 	<f:convertNumber type="number" minFractionDigits="2" maxFractionDigits="2"/>	           															 	
						</p:inputText>	
					</p:panelGrid>
					<br></br>
					<p:dataTable id="tbItens" var="i" value="#{baixabemMB.itens}" emptyMessage="Nenhum item adicionado." style="width:50%">
					    <p:column headerText="Código" width="12%">
					        <h:outputText value="#{i.patrimonio}" />
					    </p:column>
					    <p:column headerText="Plaqueta" width="12%">
					        <h:outputText value="#{i.numpla}" />
					    </p:column>				 
					    <p:column headerText="Descrição">
					        <h:outputText value="#{i.descricao}" />
					    </p:column>
				        <p:column headerText="Aquisição" style="width:15%;">
			               <h:outputText value="#{i.dataaquisicao}">
							   <f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR"/>
						   </h:outputText>
			            </p:column>					    
					    <p:column headerText="Vlr.Compra" width="15%">
					        <h:outputText value="#{i.vlraquisicao}">
					        	<f:convertNumber  minFractionDigits="2" maxFractionDigits="2" type="currency"/>
					        </h:outputText>
					    </p:column>					    
					    <p:column headerText="Vlr.Residual" width="15%">
					        <h:outputText value="#{i.vlrresidual}">
					        	<f:convertNumber  minFractionDigits="2" maxFractionDigits="2" type="currency"/>
					        </h:outputText>
					    </p:column>						    
			            <p:column headerText="Remover" width="60px;">
			                <p:commandButton action="#{baixabemMB.addItensRemovido(i)}" icon="ui-icon-trash" update="tbItens,:formCad:dados,:formCad:ptrs" process="tbItens">
			                    <p:collector value="#{i}" removeFrom="#{baixabemMB.itens}" unique="true"/>
			                </p:commandButton>
			            </p:column>
					</p:dataTable>											
				</p:panel>				
			</p:tab>
			
	        <p:tab id="just" title="Justificativas">
	        	<p:panel header="Justificativas" >
	        	<p:messages autoUpdate="true"/>
					<p:panelGrid columns="2" >		
						<h:outputLabel value="Valor de Venda" rendered="#{baixabemMB.isVenda}"/>
						<p:inputText value="#{baixabemMB.baixabem.vlrvenda}" size="9" disabled="#{baixabemMB.controlaCadastro == 0}" rendered="#{baixabemMB.isVenda}">	
						 	<f:convertNumber type="number" minFractionDigits="2" maxFractionDigits="2"/>	           															 	
						</p:inputText>				
						<h:outputLabel value="Justificativa"/>
						<p:inputTextarea value="#{baixabemMB.baixabem.justificativa}" cols="42" rows="4" disabled="#{baixabemMB.controlaCadastro == 0}" />	
					</p:panelGrid>
	        	</p:panel>
	        </p:tab>	        		

	        <p:tab id="confirm" title="Confirmação">
	            <p:panel header="Confirmação">
	                <h:panelGrid id="confirmation" columns="2" columnClasses="grid,grid">
	                    <h:panelGrid columns="2" columnClasses="label, value">
	                        <h:outputLabel value="Filial: " />
	                        <h:outputText value="#{baixabemMB.baixabem.filial.nome}" styleClass="outputLabel"/>
	 
	                        <h:outputLabel value="Centro de Custo: " />
	                        <h:outputText value="#{baixabemMB.baixabem.ccusto.nome}" styleClass="outputLabel"/>
	 
	                        <h:outputLabel value="Tipo de Baixa: " />
	                        <h:outputText value="#{baixabemMB.tipoBaixa}" styleClass="outputLabel"/>
	
	                        <h:outputLabel value="Data da Baixa: " />
	                        <h:outputText value="#{baixabemMB.data}" styleClass="outputLabel">
	                        	<f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR"/>
				  			</h:outputText>
				  				 
	                        <h:outputLabel value="Valor Total de Aquisição: " />
					        <h:outputText value="#{baixabemMB.totalCompra}">
					        	<f:convertNumber type="number" minFractionDigits="2" maxFractionDigits="2"/>
					        </h:outputText>	 
					        
	                        <h:outputLabel value="Valor Residual Total: " />
					        <h:outputText value="#{baixabemMB.totalResidual}">
					        	<f:convertNumber type="number" minFractionDigits="2" maxFractionDigits="2"/>
					        </h:outputText>
					        	
	                        <h:outputLabel value="Valor de Venda: " />
					        <h:outputText value="#{baixabemMB.baixabem.vlrvenda}">
					        	<f:convertNumber type="number" minFractionDigits="2" maxFractionDigits="2"/>
					        </h:outputText>
					        	 
	                        <h:outputLabel value="Justificativa: " />
	                        <h:outputText value="#{baixabemMB.baixabem.justificativa}" styleClass="outputLabel"/>
	                        
						</h:panelGrid>
	                </h:panelGrid>
					<h:panelGrid columns="2" columnClasses="label, value">
	                       
						<p:dataTable  var="i" value="#{baixabemMB.itens}"  emptyMessage="" style="width:50%">
						    <f:facet name="header">Patrimônios</f:facet>
						    <p:column headerText="Código" width="15%">
						        <h:outputText value="#{i.patrimonio}" />
						    </p:column>
						    <p:column headerText="Plaqueta" width="15%">
						        <h:outputText value="#{i.numpla}" />
						    </p:column>				 
						    <p:column headerText="Descrição">
						        <h:outputText value="#{i.descricao}" />
						    </p:column>
						    <p:column headerText="Vlr.Compra" width="15%">
						        <h:outputText value="#{i.vlraquisicao}">
						        	<f:convertNumber  minFractionDigits="2" maxFractionDigits="2" type="currency"/>
						        </h:outputText>
						    </p:column>					    
						    <p:column headerText="Vlr.Residual" width="15%">
						        <h:outputText value="#{i.vlrresidual}">
						        	<f:convertNumber  minFractionDigits="2" maxFractionDigits="2" type="currency"/>
						        </h:outputText>
						    </p:column>						    
					    </p:dataTable>
						<h:outputText value="" />						
	
	               </h:panelGrid>
                   <br></br>
                   <br></br>
					<f:facet name="footer">
			            <p:commandButton value="Salvar" action="#{baixabemMB.grava}" update=":formMsg,:formCad" icon="ui-icon-disk"  onstart="PF('status').show()" onsuccess="PF('status').hide()" disabled="#{baixabemMB.controlaCadastro == 0}"/>					
					</f:facet>
	            </p:panel>
	        </p:tab>
	
		</p:wizard>

		<br></br>
		<f:facet name="footer">
			<p:panelGrid columns="6" layout="grid" style="width:40%;">		
				<p:commandButton value="Novo" action="#{baixabemMB.novo}" update=":formCad" disabled="#{baixabemMB.controlaCadastro == 1 || baixabemMB.baixabem.id != null}"/>	
	            <p:commandButton value="Selecionar"  update=":formSelecao" oncomplete="PF('dgSelecao').show()" />
				<p:commandButton value="Imprimir" ajax="false" action="${baixabemMB.imprimir}" disabled="#{baixabemMB.baixabem.id==null}" onclick="this.form.target='_blank'" update=":formMsg" />
	            <p:commandButton value="Excluir" action="#{baixabemMB.exclui}" update=":formMsg,:formCad"  disabled="#{baixabemMB.controlaCadastro == 0 || baixabemMB.baixabem.id == null}"/>
	            <p:commandButton value="Cancelar" action="#{baixabemMB.limpaCadastro}" update=":formCad" disabled="#{baixabemMB.controlaCadastro == 0}"/>					
			</p:panelGrid>
		</f:facet>																					
		
	</p:panel>

</h:form>


<p:dialog id="dgSelecao" widgetVar="dgSelecao" appendTo="@(body)" modal="true" header="Selecionar Bens Baixados" width="40%;" resizable="false">
	<h:form id="formSelecao" style="width:600px;">

	    <p:dataTable id="tb" var="bem" value="#{baixabemMB.baixabens}" rows="10" paginator="true" >

	        <p:column headerText="Registro" >
	            <h:outputText value="#{bem.id}" />
	        </p:column>
	        <p:column headerText="Data Venda"  priority="3">
				<h:outputText value="#{bem.datavenda}">
					<f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR"/>
				</h:outputText>	            
	        </p:column>
	        <p:column headerText="Descrição" width="40%" priority="2">
	            <h:outputText value="#{bem.descricaoBem}" />
	        </p:column>
	        <p:column headerText="Valor Venda"  priority="4">
	            <h:outputText value="#{bem.vlrvenda}" >
	            	<f:convertNumber type="number" minFractionDigits="2" maxFractionDigits="2"/>	           																
				</h:outputText>	 
	        </p:column>
	        <p:column style="width:32px;text-align: center">
	             <p:commandButton update=":formCad" action="#{baixabemMB.selecao}" oncomplete="PF('dgSelecao').hide()" icon="ui-icon-pencil" title="Editar">
	                <f:setPropertyActionListener value="#{bem}" target="#{baixabemMB.baixabem}" />
	            </p:commandButton>
	        </p:column>
	    </p:dataTable>

	</h:form>
</p:dialog>

<p:dialog widgetVar="status" appendTo="@(body)"  modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
    <p:graphicImage value="img/ajaxloading.gif" />
</p:dialog>

<h:form id="formMsg">                      
    <p:growl id="msg" showDetail="true" life="6000"/> 
</h:form>

</ui:define>
</ui:composition>	
</h:body>	

</html>